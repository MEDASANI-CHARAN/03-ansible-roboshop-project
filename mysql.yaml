- name: Configure MySQL component
  hosts: mysql
  become: yes
  tasks:
  - name: Install MySQL server
    ansible.builtin.dnf:
      name: mysql-server
      state: present

  - name: Start & enable MySQL service
    ansible.builtin.service:
      name: mysqld
      state: started
      enabled: yes

  - name: Install Python MySQL dependencies
    ansible.builtin.pip:
      name:
        - PyMySQL
        - cryptography
      executable: pip3

  - name: Check if root password is already set
    ansible.builtin.shell: |
      mysql -u root -e "SELECT 1;" >/dev/null 2>&1
    register: root_password_check
    ignore_errors: yes
    changed_when: false

  - name: Debug root password check
    ansible.builtin.debug:
      msg: >
        Root password is already set? {{ root_password_check.rc != 0 }}

  # - name: Set MySQL root password (idempotent)
  #   community.mysql.mysql_user:
  #     login_user: root
  #     login_password: ''
  #     user: root
  #     host_all: yes
  #     password: 'RoboShop@1'
  #     state: present
  #   when: root_password_check.rc == 0